dist: bionic
language: minimal

services:
  - docker

env:
  global:
    - D_ORG=kyberorg
    - D_PROJECT=yalsee
    - D_TAG=native

jobs:
  include:
    - script:
        # Install GraalVM with SDKMAN
        - curl -s "https://get.sdkman.io" | bash
        - source "$HOME/.sdkman/bin/sdkman-init.sh"
        - sdk install java 20.3.0.r11-grl

        # Check if GraalVM was installed successfully
        - java -version

        # Install Maven, that uses GraalVM for later builds
        - sdk install maven

        # Show Maven using GraalVM JDK
        - mvn --version

        # Install GraalVM Native Image
        - gu install native-image

        # Check if Native Image was installed properly
        - native-image --version

        # Run GraalVM Native Image compilation of Spring Boot App
        - mvn -Pnative,noTesting clean package

        # Package to container
        - export D_REPO=${D_ORG}/${D_PROJECT}
        - docker build . -f Dockerfile.graal --tag=$D_REPO:$D_TAG
      name: "Native Image compile on Travis Host"

after_success:
  - export D_REPO=${D_ORG}/${D_PROJECT}

  - echo "Logging in to Docker hub as $D_USER"
  - docker login -u $D_USER -p $D_PASS
  - echo "Pushing image to $D_REPO"
  - docker push $D_REPO

notifications:
  email:
    - root@kyberorg.io

